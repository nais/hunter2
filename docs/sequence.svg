<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="741px" preserveAspectRatio="none" style="width:990px;height:741px;" version="1.1" viewBox="0 0 990 741" width="990px" zoomAndPan="magnify"><defs><filter height="300%" id="f1mk842sx6fcbm" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="204" x="389.5" y="29.4023">Hunter2 Sequence Flow</text><rect fill="#DDDDDD" height="694.2109" style="stroke: #A80036; stroke-width: 1.0;" width="444.5" x="158.5" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="295.75" y="53.7676">Google Project Resources</text><rect fill="#DDDDDD" height="694.2109" style="stroke: #A80036; stroke-width: 1.0;" width="290" x="677" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="720.5" y="53.7676">Kubernetes Cluster Resources</text><rect fill="#FFFFFF" filter="url(#f1mk842sx6fcbm)" height="107.2422" style="stroke: #000000; stroke-width: 2.0;" width="506" x="467" y="361.1719"/><rect fill="#FFFFFF" filter="url(#f1mk842sx6fcbm)" height="46.6211" style="stroke: #000000; stroke-width: 2.0;" width="276" x="477" y="414.793"/><rect fill="#FFFFFF" filter="url(#f1mk842sx6fcbm)" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="302" x="671" y="511.7246"/><rect fill="#FFFFFF" height="44.2656" style="stroke: none; stroke-width: 1.0;" width="302" x="671" y="558.3457"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="42" x2="42" y1="123.6875" y2="648.9219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="224.5" x2="224.5" y1="123.6875" y2="648.9219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="342.5" x2="342.5" y1="123.6875" y2="648.9219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="543" x2="543" y1="123.6875" y2="648.9219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="712" x2="712" y1="123.6875" y2="648.9219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="933" x2="933" y1="123.6875" y2="648.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="5" y="120.7344">Developer</text><ellipse cx="42.5" cy="50.1992" fill="#FEFECE" filter="url(#f1mk842sx6fcbm)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M42.5,58.1992 L42.5,85.1992 M29.5,66.1992 L55.5,66.1992 M42.5,85.1992 L29.5,100.1992 M42.5,85.1992 L55.5,100.1992 " fill="none" filter="url(#f1mk842sx6fcbm)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="5" y="661.457">Developer</text><ellipse cx="42.5" cy="674.4102" fill="#FEFECE" filter="url(#f1mk842sx6fcbm)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M42.5,682.4102 L42.5,709.4102 M29.5,690.4102 L55.5,690.4102 M42.5,709.4102 L29.5,724.4102 M42.5,709.4102 L55.5,724.4102 " fill="none" filter="url(#f1mk842sx6fcbm)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1mk842sx6fcbm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="162.5" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="169.5" y="108.7344">Secret Manager</text><rect fill="#FEFECE" filter="url(#f1mk842sx6fcbm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="162.5" y="647.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="169.5" y="668.457">Secret Manager</text><rect fill="#FEFECE" filter="url(#f1mk842sx6fcbm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="296.5" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="303.5" y="108.7344">Log Router</text><rect fill="#FEFECE" filter="url(#f1mk842sx6fcbm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="296.5" y="647.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="303.5" y="668.457">Log Router</text><rect fill="#FEFECE" filter="url(#f1mk842sx6fcbm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="487" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="494" y="108.7344">PubSub Topic</text><rect fill="#FEFECE" filter="url(#f1mk842sx6fcbm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="487" y="647.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="494" y="668.457">PubSub Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="681" y="120.7344">Hunter2</text><ellipse cx="712" cy="91.1992" fill="#FEFECE" filter="url(#f1mk842sx6fcbm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="708,79.1992,714,74.1992,712,79.1992,714,84.1992,708,79.1992" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="681" y="661.457">Hunter2</text><ellipse cx="712" cy="680.4102" fill="#FEFECE" filter="url(#f1mk842sx6fcbm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="708,668.4102,714,663.4102,712,668.4102,714,673.4102,708,668.4102" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1mk842sx6fcbm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="903" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="910" y="108.7344">Secret</text><rect fill="#FEFECE" filter="url(#f1mk842sx6fcbm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="903" y="647.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="910" y="668.457">Secret</text><polygon fill="#A80036" points="212.5,181.6191,222.5,185.6191,212.5,189.6191,216.5,185.6191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="42.5" x2="218.5" y1="185.6191" y2="185.6191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="49.5" y="165.5664">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="62.5" y="150.2559">create secret /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="62.5" y="165.5664">create secret version /</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="62.5" y="180.877">delete secret</text><polygon fill="#A80036" points="331,210.9297,341,214.9297,331,218.9297,335,214.9297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="224.5" x2="337" y1="214.9297" y2="214.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="231.5" y="210.1875">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63" x="244.5" y="210.1875">audit logs</text><polygon fill="#A80036" points="531,240.2402,541,244.2402,531,248.2402,535,244.2402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="343" x2="537" y1="244.2402" y2="244.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="350" y="239.498">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="363" y="239.498">publish filtered audit logs</text><polygon fill="#A80036" points="554,269.5508,544,273.5508,554,277.5508,550,273.5508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="548" x2="711" y1="273.5508" y2="273.5508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="560" y="268.8086">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="573" y="268.8086">subscribe to updates</text><rect fill="#EEEEEE" filter="url(#f1mk842sx6fcbm)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="983" x="0" y="302.2061"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="983" y1="302.2061" y2="302.2061"/><line style="stroke: #000000; stroke-width: 1.0;" x1="0" x2="983" y1="305.2061" y2="305.2061"/><rect fill="#EEEEEE" filter="url(#f1mk842sx6fcbm)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="116" x="433.5" y="291.5508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="439.5" y="308.1191">on new events</text><polygon fill="#A80036" points="921,342.1719,931,346.1719,921,350.1719,925,346.1719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="712" x2="927" y1="346.1719" y2="346.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="719" y="341.4297">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="732" y="341.4297">check if exists</text><path d="M467,361.1719 L718,361.1719 L718,368.1719 L708,378.1719 L467,378.1719 L467,361.1719 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="107.2422" style="stroke: #000000; stroke-width: 2.0;" width="506" x="467" y="361.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="206" x="482" y="374.7402">secret already exists in cluster</text><polygon fill="#A80036" points="921,395.793,931,399.793,921,403.793,925,399.793" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="712" x2="927" y1="399.793" y2="399.793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="719" y="395.0508">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="732" y="395.0508">check for specific annotation</text><path d="M477,414.793 L665,414.793 L665,421.793 L655,431.793 L477,431.793 L477,414.793 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="46.6211" style="stroke: #000000; stroke-width: 2.0;" width="276" x="477" y="414.793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="143" x="492" y="428.3613">annotation not found</text><polygon fill="#A80036" points="554,449.4141,544,453.4141,554,457.4141,550,453.4141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="548" x2="711" y1="453.4141" y2="453.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="560" y="448.6719">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="573" y="448.6719">ack and return early</text><polygon fill="#A80036" points="235.5,492.7246,225.5,496.7246,235.5,500.7246,231.5,496.7246" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="229.5" x2="711" y1="496.7246" y2="496.7246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="241.5" y="491.9824">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="254.5" y="491.9824">fetch secret metadata and data</text><path d="M671,511.7246 L966,511.7246 L966,518.7246 L956,528.7246 L671,528.7246 L671,511.7246 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="302" x="671" y="511.7246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="250" x="686" y="525.293">if secret not found in Secret Manager</text><polygon fill="#A80036" points="921,546.3457,931,550.3457,921,554.3457,925,550.3457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="712" x2="927" y1="550.3457" y2="550.3457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="719" y="545.6035">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="732" y="545.6035">delete</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="671" x2="973" y1="559.3457" y2="559.3457"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="676" y="569.9805">[else]</text><polygon fill="#A80036" points="921,590.6113,931,594.6113,921,598.6113,925,594.6113" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="712" x2="927" y1="594.6113" y2="594.6113"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="719" y="589.8691">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="741" y="589.8691">create or update</text><polygon fill="#A80036" points="554,626.9219,544,630.9219,554,634.9219,550,630.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="548" x2="711" y1="630.9219" y2="630.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="560" y="626.1797">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="582" y="626.1797">ack message</text><!--MD5=[30eba43fad5a4395baef3f7fb12201f6]
@startuml component
title Hunter2 Sequence Flow
skinparam maxMessageSize 300
autonumber

actor developer as "Developer"

box "Google Project Resources"
participant SecretManager as "Secret Manager"
participant LogRouter as "Log Router"
participant PubSub as "PubSub Topic"
end box

box "Kubernetes Cluster Resources"
control hunter as "Hunter2"
participant Secret
end box

developer -> SecretManager: create secret / \ncreate secret version / \ndelete secret
SecretManager -> LogRouter: audit logs
LogRouter -> PubSub: publish filtered audit logs
hunter -> PubSub: subscribe to updates

== on new events ==

hunter -> Secret: check if exists
group secret already exists in cluster
  hunter -> Secret: check for specific annotation
  group annotation not found
    hunter -> PubSub: ack and return early
  end
end

hunter -> SecretManager: fetch secret metadata and data

group if secret not found in Secret Manager
  hunter -> Secret: delete
else else
  hunter -> Secret: create or update
end

hunter -> PubSub: ack message

@enduml

PlantUML version 1.2020.20(Sat Nov 21 11:02:45 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: NO
--></g></svg>